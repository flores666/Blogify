@model List<lib.Blog.Objects.Post>

@{
    var query = ViewBag.Query ?? null;
}

<link rel="stylesheet" href="/css/feed.css">

<script>
    function loadPosts(pageNumber) {
        let displayedPosts = [];
        $.ajax({
            url: '/Blog/GetPostsAsJSON',
            type: 'POST',
            data: { pageNumber: pageNumber },
            dataType: 'json',
            success: function (data) {
                if (data && data.length > 0) {
                    let posts = [];
                    data.forEach(function (post) {
                        if (!displayedPosts.includes(post.id)) {
                            posts.push(post);
                            displayedPosts.push(post.id); 
                        }
                    });
                    
                    $.ajax({
                        url: '/Blog/DrawPosts',
                        type: 'POST',
                        data: { posts : posts },
                        success: function (partialView) {
                            $('.feed').append(partialView);
                        }
                    });
                }
            }
        });
    }
       let curPage = 0; 
        $(window).scroll(function () {
            if ($(window).scrollTop() == $(document).height() - $(window).height()) {
                curPage++;
                loadPosts(curPage);
            }
        });
</script>

<div class="container">
    @Html.Partial("_SearchTemplate")
    <div class="feed mb-4">
        @Html.Partial("_FeedPartial", Model)
    </div>
</div>